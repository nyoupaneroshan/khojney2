(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[439],{4931:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(98889).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},12463:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(98889).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},14244:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(98889).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},15320:(e,t,s)=>{"use strict";s.d(t,{default:()=>w});var n=s(54568),r=s(7620),i=s(62942),a=s(36958),l=s(4931),o=s(12463),c=s(49369),d=s(14244),u=s(32545),h=s(49645);let f=e=>{let{current:t,total:s}=e;return(0,n.jsx)("div",{className:"w-full bg-slate-700/50 rounded-full h-2",children:(0,n.jsx)(u.P.div,{className:"bg-cyan-400 h-2 rounded-full",initial:{width:"0%"},animate:{width:"".concat(s>0?(t+1)/s*100:0,"%")},transition:{duration:.5,ease:"easeInOut"}})})},m=e=>{let{timeLeft:t,totalTime:s}=e,r=2*Math.PI*20,i=r*(1-t/s),a=t<=5?"text-red-400":"text-cyan-300";return(0,n.jsxs)("div",{className:"relative h-20 w-20",children:[(0,n.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 44 44",transform:"rotate(-90 22 22)",children:[(0,n.jsx)("circle",{className:"text-slate-700",strokeWidth:"4",stroke:"currentColor",fill:"transparent",r:"20",cx:"22",cy:"22"}),(0,n.jsx)(u.P.circle,{className:t<=5?"text-red-500":"text-cyan-400",strokeWidth:"4",strokeDasharray:r,strokeDashoffset:r,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:"20",cx:"22",cy:"22",animate:{strokeDashoffset:i},transition:{duration:1,ease:"linear"}})]}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center font-mono text-2xl font-bold ".concat(a),children:t})]})},x=e=>{let{option:t,state:s,onClick:r,index:i}=e,a={correct:(0,n.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,n.jsx)(l.A,{className:"h-5 w-5 text-white"})}),incorrect:(0,n.jsx)("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:(0,n.jsx)(o.A,{className:"h-5 w-5 text-white"})}),default:(0,n.jsx)("div",{className:"w-6 h-6 border-2 border-slate-500 rounded-full flex items-center justify-center text-cyan-400 font-bold text-sm",children:i+1})};return(0,n.jsx)(u.P.li,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.05*i},children:(0,n.jsxs)("button",{onClick:r,disabled:"default"!==s,className:"".concat("w-full text-left p-4 rounded-lg border-2 transition-all duration-200 flex items-center gap-4 text-lg backdrop-blur-sm"," ").concat({default:"bg-slate-800/50 border-slate-700 hover:border-cyan-500/70 hover:bg-slate-700/50 text-slate-200",correct:"bg-green-500/20 border-green-500 text-white font-semibold ring-2 ring-green-500/50",incorrect:"bg-red-500/20 border-red-500 text-white font-semibold"}[s]),children:[a[s],(0,n.jsx)("span",{children:t.option_text_en})]})})},p=e=>{let t=e.length,s;for(;0!==t;)s=Math.floor(Math.random()*t),t--,[e[t],e[s]]=[e[s],e[t]];return e};function w(e){let{category:t,initialQuestions:s,user:l,quizModes:o}=e,w=(0,i.useRouter)(),g=(0,i.useSearchParams)(),y=(0,r.useRef)(!1),[b,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(null),[k,_]=(0,r.useState)(0),[I,M]=(0,r.useState)(new Map),[C,E]=(0,r.useState)(0),[P,z]=(0,r.useState)("unanswered"),[S,R]=(0,r.useState)(null),[A,q]=(0,r.useState)(15),L=(0,r.useMemo)(()=>o.find(e=>e.id===g.get("mode"))||o[0],[o,g]),O=(0,r.useMemo)(()=>p([...s]),[s]),D=(0,r.useMemo)(()=>O[k],[O,k]),X=(0,r.useMemo)(()=>D?p([...D.options]):[],[D]),J=(0,r.useCallback)(async e=>{if(!v||b)return;j(!0);let t=0;e.forEach((e,s)=>{let n=O.find(e=>e.id===s),r=null==n?void 0:n.options.find(e=>e.is_correct);r&&e===r.id&&t++});let s=Math.round((Date.now()-C)/1e3),n=Array.from(e.entries()).map(e=>{var t,s;let[n,r]=e;return{quiz_attempt_id:v,question_id:n,selected_option_id:r,is_correct:r===(null==(s=O.find(e=>e.id===n))||null==(t=s.options.find(e=>e.is_correct))?void 0:t.id)}});try{n.length>0&&await a.N.from("user_answers").insert(n),await a.N.from("quiz_attempts").update({score:t,status:"completed",completed_at:new Date().toISOString(),time_taken_seconds:s}).eq("id",v),w.push("/quiz/results/".concat(v))}catch(e){console.error("Error finishing quiz:",e),j(!1)}},[v,b,O,C,w]),Q=(0,r.useCallback)(()=>{"answered"===P&&(k<O.length-1?(_(e=>e+1),z("unanswered"),R(null),q(15)):J(I))},[k,O.length,J,I,P]),F=(0,r.useCallback)(e=>{if("answered"===P||!D)return;z("answered"),R(e.id);let t=new Map(I);t.set(D.id,e.id),M(t)},[P,D,I]),V=(0,r.useCallback)(e=>{if("answered"===P){("Enter"===e.key||" "===e.key)&&Q();return}let t=parseInt(e.key);t>=1&&t<=X.length&&F(X[t-1])},[P,X,F,Q]);if((0,r.useEffect)(()=>{if(y.current)return;y.current=!0;let e=async()=>{let e={limit:g.get("limit"),difficulty:g.get("difficulty"),mode:null==L?void 0:L.name_en},{data:s,error:n}=await a.N.from("quiz_attempts").insert({user_id:l.id,category_id:t.id,status:"started",quiz_mode_id:null==L?void 0:L.id,settings_snapshot:e}).select("id").single();n?console.error("Failed to create quiz attempt:",n):(N(s.id),E(Date.now()))};l&&t.id&&L&&e()},[t.id,l.id,g,L]),(0,r.useEffect)(()=>{if("answered"===P||!v)return;if(0===A){z("answered"),setTimeout(()=>Q(),1500);return}let e=setInterval(()=>q(e=>e>0?e-1:0),1e3);return()=>clearInterval(e)},[A,P,v,Q]),(0,r.useEffect)(()=>(window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)),[V]),!v||!D)return(0,n.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 bg-slate-900 text-white",children:[(0,n.jsx)(c.A,{className:"h-12 w-12 animate-spin text-cyan-400 mb-4"}),(0,n.jsx)("p",{className:"text-xl text-slate-300",children:"Preparing your quiz..."})]});let W=D.options.find(e=>e.is_correct).id;return(0,n.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 sm:p-6 bg-slate-900 text-white overflow-hidden",children:(0,n.jsx)("div",{className:"w-full max-w-2xl",children:(0,n.jsx)(h.N,{mode:"wait",children:(0,n.jsxs)(u.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.4,ease:"easeInOut"},className:"bg-slate-800/50 p-6 sm:p-8 rounded-2xl shadow-2xl border border-slate-700/60 w-full",children:[(0,n.jsxs)("header",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-lg font-bold text-cyan-400",children:t.name_en}),(0,n.jsxs)("p",{className:"text-sm text-slate-400",children:["Question ",k+1," of ",O.length]})]}),(0,n.jsx)(m,{timeLeft:A,totalTime:15})]}),(0,n.jsx)(f,{current:k,total:O.length})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold mb-6 text-slate-100 min-h-[6rem] flex items-center",children:D.question_text_en}),(0,n.jsx)("ul",{className:"space-y-3 mb-6",children:X.map((e,t)=>{let s="default";return"answered"===P&&(e.id===W?s="correct":e.id===S&&(s="incorrect")),(0,n.jsx)(x,{option:e,state:s,onClick:()=>F(e),index:t},e.id)})})]}),(0,n.jsxs)("footer",{className:"flex justify-between items-center text-right h-14 mt-8 pt-4 border-t border-slate-700/50",children:[(0,n.jsxs)("button",{onClick:()=>w.push("/"),className:"text-slate-400 hover:text-slate-200 transition-colors text-sm flex items-center gap-2",children:[(0,n.jsx)(d.A,{size:16})," Quit"]}),"answered"===P&&(0,n.jsx)(u.P.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:Q,disabled:b,className:"bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 px-8 rounded-lg disabled:bg-slate-600 disabled:cursor-not-allowed flex items-center gap-2",children:b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.A,{className:"animate-spin h-5 w-5"})," Saving..."]}):k<O.length-1?"Next Question":"Finish Quiz"})]})]},D.id)})})})}},36958:(e,t,s)=>{"use strict";s.d(t,{N:()=>n});let n=(0,s(36154).createBrowserClient)("https://uxpdqthqyttujyvqwaeh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4cGRxdGhxeXR0dWp5dnF3YWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NzE3MzgsImV4cCI6MjA2NDU0NzczOH0.clopYxo2qaXYmw4poLnEoJOe6hXXotZwR3GYZL_GdMQ")},49369:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(98889).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},49645:(e,t,s)=>{"use strict";s.d(t,{N:()=>g});var n=s(54568),r=s(7620),i=s(78386),a=s(38094),l=s(96303),o=s(90548),c=s(5840),d=s(43877);class u extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,s=(0,c.s)(e)&&e.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=s-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function h(e){let{children:t,isPresent:s,anchorX:i}=e,a=(0,r.useId)(),l=(0,r.useRef)(null),o=(0,r.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,r.useContext)(d.Q);return(0,r.useInsertionEffect)(()=>{let{width:e,height:t,top:n,left:r,right:d}=o.current;if(s||!l.current||!e||!t)return;l.current.dataset.motionPopId=a;let u=document.createElement("style");return c&&(u.nonce=c),document.head.appendChild(u),u.sheet&&u.sheet.insertRule('\n          [data-motion-pop-id="'.concat(a,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat("left"===i?"left: ".concat(r):"right: ".concat(d),"px !important;\n            top: ").concat(n,"px !important;\n          }\n        ")),()=>{document.head.contains(u)&&document.head.removeChild(u)}},[s]),(0,n.jsx)(u,{isPresent:s,childRef:l,sizeRef:o,children:r.cloneElement(t,{ref:l})})}let f=e=>{let{children:t,initial:s,isPresent:i,onExitComplete:l,custom:c,presenceAffectsLayout:d,mode:u,anchorX:f}=e,x=(0,a.M)(m),p=(0,r.useId)(),w=!0,g=(0,r.useMemo)(()=>(w=!1,{id:p,initial:s,isPresent:i,custom:c,onExitComplete:e=>{for(let t of(x.set(e,!0),x.values()))if(!t)return;l&&l()},register:e=>(x.set(e,!1),()=>x.delete(e))}),[i,x,l]);return d&&w&&(g={...g}),(0,r.useMemo)(()=>{x.forEach((e,t)=>x.set(t,!1))},[i]),r.useEffect(()=>{i||x.size||!l||l()},[i]),"popLayout"===u&&(t=(0,n.jsx)(h,{isPresent:i,anchorX:f,children:t})),(0,n.jsx)(o.t.Provider,{value:g,children:t})};function m(){return new Map}var x=s(69219);let p=e=>e.key||"";function w(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}let g=e=>{let{children:t,custom:s,initial:o=!0,onExitComplete:c,presenceAffectsLayout:d=!0,mode:u="sync",propagate:h=!1,anchorX:m="left"}=e,[g,y]=(0,x.xQ)(h),b=(0,r.useMemo)(()=>w(t),[t]),j=h&&!g?[]:b.map(p),v=(0,r.useRef)(!0),N=(0,r.useRef)(b),k=(0,a.M)(()=>new Map),[_,I]=(0,r.useState)(b),[M,C]=(0,r.useState)(b);(0,l.E)(()=>{v.current=!1,N.current=b;for(let e=0;e<M.length;e++){let t=p(M[e]);j.includes(t)?k.delete(t):!0!==k.get(t)&&k.set(t,!1)}},[M,j.length,j.join("-")]);let E=[];if(b!==_){let e=[...b];for(let t=0;t<M.length;t++){let s=M[t],n=p(s);j.includes(n)||(e.splice(t,0,s),E.push(s))}return"wait"===u&&E.length&&(e=E),C(w(e)),I(b),null}let{forceRender:P}=(0,r.useContext)(i.L);return(0,n.jsx)(n.Fragment,{children:M.map(e=>{let t=p(e),r=(!h||!!g)&&(b===M||j.includes(t));return(0,n.jsx)(f,{isPresent:r,initial:(!v.current||!!o)&&void 0,custom:s,presenceAffectsLayout:d,mode:u,onExitComplete:r?void 0:()=>{if(!k.has(t))return;k.set(t,!0);let e=!0;k.forEach(t=>{t||(e=!1)}),e&&(null==P||P(),C(N.current),h&&(null==y||y()),c&&c())},anchorX:m,children:e},t)})})}},62942:(e,t,s)=>{"use strict";var n=s(42418);s.o(n,"usePathname")&&s.d(t,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})},84880:(e,t,s)=>{Promise.resolve().then(s.bind(s,15320))}},e=>{var t=t=>e(e.s=t);e.O(0,[209,154,587,315,358],()=>t(84880)),_N_E=e.O()}]);