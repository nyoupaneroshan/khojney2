(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{12463:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(98889).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},12608:(e,t,s)=>{Promise.resolve().then(s.bind(s,98303))},15173:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(98889).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},19594:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(98889).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},36958:(e,t,s)=>{"use strict";s.d(t,{N:()=>r});let r=(0,s(36154).createBrowserClient)("https://uxpdqthqyttujyvqwaeh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4cGRxdGhxeXR0dWp5dnF3YWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NzE3MzgsImV4cCI6MjA2NDU0NzczOH0.clopYxo2qaXYmw4poLnEoJOe6hXXotZwR3GYZL_GdMQ")},49645:(e,t,s)=>{"use strict";s.d(t,{N:()=>y});var r=s(54568),l=s(7620),a=s(78386),n=s(38094),i=s(96303),o=s(90548),c=s(5840),d=s(43877);class u extends l.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,s=(0,c.s)(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=s-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function m(e){let{children:t,isPresent:s,anchorX:a}=e,n=(0,l.useId)(),i=(0,l.useRef)(null),o=(0,l.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,l.useContext)(d.Q);return(0,l.useInsertionEffect)(()=>{let{width:e,height:t,top:r,left:l,right:d}=o.current;if(s||!i.current||!e||!t)return;i.current.dataset.motionPopId=n;let u=document.createElement("style");return c&&(u.nonce=c),document.head.appendChild(u),u.sheet&&u.sheet.insertRule('\n          [data-motion-pop-id="'.concat(n,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat("left"===a?"left: ".concat(l):"right: ".concat(d),"px !important;\n            top: ").concat(r,"px !important;\n          }\n        ")),()=>{document.head.contains(u)&&document.head.removeChild(u)}},[s]),(0,r.jsx)(u,{isPresent:s,childRef:i,sizeRef:o,children:l.cloneElement(t,{ref:i})})}let h=e=>{let{children:t,initial:s,isPresent:a,onExitComplete:i,custom:c,presenceAffectsLayout:d,mode:u,anchorX:h}=e,p=(0,n.M)(x),f=(0,l.useId)(),g=!0,y=(0,l.useMemo)(()=>(g=!1,{id:f,initial:s,isPresent:a,custom:c,onExitComplete:e=>{for(let t of(p.set(e,!0),p.values()))if(!t)return;i&&i()},register:e=>(p.set(e,!1),()=>p.delete(e))}),[a,p,i]);return d&&g&&(y={...y}),(0,l.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[a]),l.useEffect(()=>{a||p.size||!i||i()},[a]),"popLayout"===u&&(t=(0,r.jsx)(m,{isPresent:a,anchorX:h,children:t})),(0,r.jsx)(o.t.Provider,{value:y,children:t})};function x(){return new Map}var p=s(69219);let f=e=>e.key||"";function g(e){let t=[];return l.Children.forEach(e,e=>{(0,l.isValidElement)(e)&&t.push(e)}),t}let y=e=>{let{children:t,custom:s,initial:o=!0,onExitComplete:c,presenceAffectsLayout:d=!0,mode:u="sync",propagate:m=!1,anchorX:x="left"}=e,[y,j]=(0,p.xQ)(m),b=(0,l.useMemo)(()=>g(t),[t]),N=m&&!y?[]:b.map(f),v=(0,l.useRef)(!0),w=(0,l.useRef)(b),k=(0,n.M)(()=>new Map),[A,C]=(0,l.useState)(b),[z,E]=(0,l.useState)(b);(0,i.E)(()=>{v.current=!1,w.current=b;for(let e=0;e<z.length;e++){let t=f(z[e]);N.includes(t)?k.delete(t):!0!==k.get(t)&&k.set(t,!1)}},[z,N.length,N.join("-")]);let _=[];if(b!==A){let e=[...b];for(let t=0;t<z.length;t++){let s=z[t],r=f(s);N.includes(r)||(e.splice(t,0,s),_.push(s))}return"wait"===u&&_.length&&(e=_),E(g(e)),C(b),null}let{forceRender:M}=(0,l.useContext)(a.L);return(0,r.jsx)(r.Fragment,{children:z.map(e=>{let t=f(e),l=(!m||!!y)&&(b===z||N.includes(t));return(0,r.jsx)(h,{isPresent:l,initial:(!v.current||!!o)&&void 0,custom:s,presenceAffectsLayout:d,mode:u,onExitComplete:l?void 0:()=>{if(!k.has(t))return;k.set(t,!0);let e=!0;k.forEach(t=>{t||(e=!1)}),e&&(null==M||M(),E(w.current),m&&(null==j||j()),c&&c())},anchorX:x,children:e},t)})})}},68262:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(98889).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},69634:(e,t,s)=>{"use strict";s.d(t,{O:()=>i,e:()=>n});var r=s(54568),l=s(27261),a=s.n(l);let n=()=>(0,r.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-24",children:(0,r.jsx)("p",{children:"Loading admin section..."})}),i=()=>(0,r.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-24",children:[(0,r.jsx)("h1",{className:"text-2xl text-red-500",children:"Access Denied"}),(0,r.jsx)("p",{className:"mt-4",children:"You must be an admin to view this page."}),(0,r.jsx)(a(),{href:"/",className:"text-blue-400 hover:text-blue-300 mt-6",children:"Go to Homepage"})]})},82055:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(98889).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},88276:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(98889).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},98303:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var r=s(54568),l=s(7620),a=s(27261),n=s.n(a),i=s(36958),o=s(32545),c=s(49645),d=s(88276),u=s(82055),m=s(98889);let h=(0,m.A)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var x=s(19594),p=s(15173);let f=(0,m.A)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),g=(0,m.A)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);var y=s(68262),j=s(69634),b=s(12463);function N(e){let{user:t,onSave:s,onCancel:a}=e,[n,o]=(0,l.useState)(t.full_name||""),[c,d]=(0,l.useState)(t.role),[u,m]=(0,l.useState)(!1),[h,x]=(0,l.useState)(null),p=async e=>{e.preventDefault(),m(!0),x(null);let r={full_name:n,role:c};try{let{error:e}=await i.N.from("profiles").update(r).eq("id",t.id);e?x(e.message):s(t.id,r)}catch(e){console.error("Error updating user:",e),x(e.message||"An unexpected error occurred.")}finally{m(!1)}};return(0,r.jsxs)("div",{className:"p-8",children:[" ",(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold text-white",children:["Edit User: ",t.full_name||t.id]}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-gray-700","aria-label":"Close",children:(0,r.jsx)(b.A,{size:24})})]}),(0,r.jsxs)("form",{onSubmit:p,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-300 mb-1",children:"Full Name"}),(0,r.jsx)("input",{id:"fullName",type:"text",value:n,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 mt-1 text-white bg-gray-700 border border-gray-600 rounded-md placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-gray-900",disabled:u})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-300 mb-1",children:"User Role"}),(0,r.jsxs)("select",{id:"role",value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 mt-1 text-white bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-gray-900",disabled:u,children:[(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"premium_user",children:"Premium User"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})]}),h&&(0,r.jsx)("p",{className:"text-red-400 text-sm mt-4 text-center",children:h}),(0,r.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-6 py-2 font-bold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"px-6 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-500 transition-colors focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",disabled:u,children:u?"Saving...":"Save Changes"})]})]})]})}let v=e=>{let{icon:t,title:s,value:l,colorClass:a}=e;return(0,r.jsx)("div",{className:"bg-gray-800/50 border border-gray-700/80 rounded-xl p-5",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center ".concat(a),children:t}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-400",children:s}),(0,r.jsx)("p",{className:"text-2xl font-bold text-white",children:l})]})]})})};function w(){let[e,t]=(0,l.useState)(!0),[s,a]=(0,l.useState)(!1),[m,b]=(0,l.useState)([]),[w,k]=(0,l.useState)(""),[A,C]=(0,l.useState)(null),[z,E]=(0,l.useState)(null),_=async e=>{if(!confirm("Are you sure you want to send a password reset link to this user?"))return;t(!0);let{data:s,error:r}=await i.N.functions.invoke("admin-reset-password",{body:{userId:e}});r?E({message:"Failed to send password reset: ".concat(r.message),type:"error"}):E({message:"Password reset link sent successfully!",type:"success"}),t(!1)},M=async e=>{if(!confirm("DANGER: Are you sure you want to permanently delete this user? This cannot be undone."))return;t(!0);let{data:s,error:r}=await i.N.functions.invoke("admin-delete-user",{body:{userId:e}});r?E({message:"Failed to delete user: ".concat(r.message),type:"error"}):(E({message:"User deleted successfully.",type:"success"}),b(t=>t.filter(t=>t.id!==e))),t(!1)},S=(0,l.useCallback)(async()=>{let{data:e,error:t}=await i.N.rpc("get_all_users_with_email",{search_term:w}).order("created_at",{ascending:!1});t?(console.error("Error fetching users:",t),b([]),E({message:"Error fetching users: ".concat(t.message),type:"error"})):b(e||[])},[w]);(0,l.useEffect)(()=>{(async()=>{t(!0);try{let{data:{user:e}}=await i.N.auth.getUser();if(e){let{data:t,error:s}=await i.N.from("profiles").select("role").eq("id",e.id).single();if(s)throw s;t&&"admin"===t.role?(a(!0),await S()):a(!1)}else a(!1)}catch(e){console.error("Error during admin authorization check:",e),a(!1),E({message:"Authorization Error: ".concat(e.message||"Unknown error"),type:"error"})}finally{t(!1)}})()},[S]),(0,l.useEffect)(()=>{if(!s)return;let e=setTimeout(()=>{S()},500);return()=>{clearTimeout(e)}},[w,S,s]),(0,l.useEffect)(()=>{if(z){let e=setTimeout(()=>E(null),5e3);return()=>clearTimeout(e)}},[z]);let U=(0,l.useMemo)(()=>{let e=m.length,t=m.filter(e=>"admin"===e.role).length;return{total:e,admins:t,regularUsers:m.filter(e=>"user"===e.role).length,premiumUsers:m.filter(e=>"premium_user"===e.role).length}},[m]);return e&&0===m.length?(0,r.jsx)(j.e,{}):s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("main",{className:"w-full p-8 sm:p-12 bg-gray-900 text-white min-h-screen",children:(0,r.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,r.jsx)("div",{className:"mb-10",children:(0,r.jsxs)(n(),{href:"/admin",className:"inline-flex items-center gap-2 text-sm text-cyan-400 hover:text-cyan-300 transition-colors",children:[(0,r.jsx)(d.A,{size:16})," Back to Admin Dashboard"]})}),(0,r.jsx)("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4 mb-8",children:(0,r.jsx)("h1",{className:"text-4xl sm:text-5xl font-extrabold text-white",children:"User Management"})}),(0,r.jsxs)(o.P.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,r.jsx)(v,{icon:(0,r.jsx)(u.A,{size:22}),title:"Total Users",value:U.total,colorClass:"bg-purple-500/20 text-purple-300"}),(0,r.jsx)(v,{icon:(0,r.jsx)(h,{size:22}),title:"Admins",value:U.admins,colorClass:"bg-red-500/20 text-red-300"}),(0,r.jsx)(v,{icon:(0,r.jsx)(x.A,{size:22}),title:"Regular Users",value:U.regularUsers,colorClass:"bg-blue-500/20 text-blue-300"}),(0,r.jsx)(v,{icon:(0,r.jsx)(x.A,{size:22}),title:"Premium Users",value:U.premiumUsers,colorClass:"bg-yellow-500/20 text-yellow-300"})]}),(0,r.jsxs)("div",{className:"relative mb-8",children:[(0,r.jsx)(p.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),(0,r.jsx)("input",{type:"text",placeholder:"Search users by name or email...",value:w,onChange:e=>k(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg py-2 pl-10 pr-4 text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-cyan-500"})]}),(0,r.jsx)(c.N,{children:z&&(0,r.jsx)(o.P.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"fixed top-5 right-5 p-4 rounded-md shadow-lg text-white z-50 ".concat("success"===z.type?"bg-green-600":"bg-red-600"),children:z.message})}),(0,r.jsx)("div",{className:"bg-gray-800/60 border border-gray-700/60 rounded-xl shadow-lg overflow-hidden",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full text-left",children:[(0,r.jsx)("thead",{className:"bg-gray-900/50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-4 text-gray-300",children:"Full Name"}),(0,r.jsx)("th",{className:"p-4 text-gray-300",children:"Email"}),(0,r.jsx)("th",{className:"p-4 text-gray-300",children:"Last Signed In"}),(0,r.jsx)("th",{className:"p-4 text-gray-300",children:"Role"}),(0,r.jsx)("th",{className:"p-4 text-right text-gray-300",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:m.length>0?m.map(e=>(0,r.jsxs)("tr",{className:"border-t border-gray-700/50 hover:bg-gray-700/30 transition-colors",children:[(0,r.jsx)("td",{className:"p-4 font-semibold text-white",children:e.full_name||"N/A"}),(0,r.jsx)("td",{className:"p-4 text-gray-400",children:e.email||"N/A"}),(0,r.jsx)("td",{className:"p-4 text-gray-400",children:e.last_sign_in_at?new Date(e.last_sign_in_at).toLocaleString():"Never"}),(0,r.jsx)("td",{className:"p-4",children:(0,r.jsx)("span",{className:"px-3 py-1 text-xs font-semibold rounded-full ".concat("admin"===e.role?"bg-red-500/20 text-red-300":"premium_user"===e.role?"bg-amber-500/20 text-amber-300":"bg-blue-500/20 text-blue-300"),children:e.role})}),(0,r.jsx)("td",{className:"p-4 text-right",children:(0,r.jsxs)("div",{className:"flex gap-3 justify-end items-center",children:[(0,r.jsx)("button",{onClick:()=>C(e),title:"Edit User",className:"text-cyan-400 hover:text-cyan-300 p-2 rounded-md hover:bg-gray-700 transition-colors",children:(0,r.jsx)(f,{size:18})}),(0,r.jsx)("button",{onClick:()=>_(e.id),title:"Send Password Reset Link",className:"text-yellow-400 hover:text-yellow-300 p-2 rounded-md hover:bg-gray-700 transition-colors",children:(0,r.jsx)(g,{size:18})}),(0,r.jsx)("button",{onClick:()=>M(e.id),title:"Delete User",className:"text-red-500 hover:text-red-400 p-2 rounded-md hover:bg-gray-700 transition-colors",children:(0,r.jsx)(y.A,{size:18})})]})})]},e.id)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"text-center text-gray-500 py-16",children:"No users found."})})})]})})})]})}),(0,r.jsx)(c.N,{children:A&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.P.div,{className:"fixed inset-0 bg-black/60 z-40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}),(0,r.jsx)(o.P.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 right-0 h-full w-full max-w-lg bg-gray-900 shadow-2xl z-50 border-l border-gray-800",children:(0,r.jsx)(N,{user:A,onSave:(e,t)=>{b(s=>s.map(s=>s.id===e?{...s,...t}:s)),C(null),E({message:"User updated successfully!",type:"success"})},onCancel:()=>C(null)})},A.id)]})})]}):(0,r.jsx)(j.O,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[209,154,261,587,315,358],()=>t(12608)),_N_E=e.O()}]);