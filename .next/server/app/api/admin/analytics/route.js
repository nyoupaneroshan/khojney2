(()=>{var e={};e.id=678,e.ids=[678],e.modules={1241:()=>{},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44864:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>l,serverHooks:()=>x,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>d});var a=r(48106),o=r(48819),i=r(12050),n=r(85296),c=r(4235);let u=Symbol.for("constructDateFrom");function p(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&u in e?e[u](t):e instanceof Date?new e.constructor(t):new Date(t)}async function d(e){let t=(0,n.createServerClient)({cookies:()=>e.cookies}),{searchParams:r}=new URL(e.url),s=r.get("userId")||"all",a=r.get("to")?new Date(r.get("to")):new Date,o=r.get("from")?new Date(r.get("from")):function(e,t,r){var s=void 0;let a=p(s?.in||e,e);return isNaN(-30)?p(s?.in||e,NaN):(a.setDate(a.getDate()+-30),a)}(a,0);try{let{data:e}=await t.auth.getUser();if(e.user?.app_metadata.role!=="admin")return new c.NextResponse(JSON.stringify({error:"Unauthorized"}),{status:403});let[r,i,n,u]=await Promise.all([t.from("quiz_attempts").select("score, created_at, categories(name_en)").eq("status","completed").gte("created_at",o.toISOString()).lte("created_at",a.toISOString()).if("all"!==s,e=>e.eq("user_id",s)),t.from("question_stats").select("question_id, correct_percentage, total_attempts, questions(question_text_en)"),t.from("profiles").select("created_at").gte("created_at",o.toISOString()).lte("created_at",a.toISOString()),t.from("profiles").select("full_name, id").order("total_score",{ascending:!1,nulls:"last"}).limit(10)]);if(r.error)throw r.error;r.data;let p={hardest:i.data?.sort((e,t)=>e.correct_percentage-t.correct_percentage).slice(0,5)||[],easiest:i.data?.sort((e,t)=>t.correct_percentage-e.correct_percentage).slice(0,5)||[]},d=(n.data||[]).reduce((e,t)=>{let r=new Date(t.created_at).toISOString().split("T")[0];return e[r]=(e[r]||0)+1,e},{}),l=Object.entries(d).map(([e,t])=>({date:e,"New Users":t})).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),m={kpis:{},categoryChartData:[],activityChartData:[],questionStats:p,leaderboardData:u.data||[],userSignupChartData:l};return c.NextResponse.json(m)}catch(e){return new c.NextResponse(JSON.stringify({error:e.message}),{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"/Users/nyoupane/Documents/11TechMedia/QuizApp/khojney/khojney_main/khojney-app/new_khojney/khojney-main/src/app/api/admin/analytics/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:x}=l;function f(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72088:()=>{},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},80765:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=80765,e.exports=t},81630:e=>{"use strict";e.exports=require("http")},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[50,296,744],()=>r(44864));module.exports=s})();